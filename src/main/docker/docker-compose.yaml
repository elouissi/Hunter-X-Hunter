  version: '3.8'

  services:
    # Service pour l'application Spring Boot
    app:
      image: jenkins_sonar:latest
      container_name: hunters_league_app
      ports:
        - "8443:8443"
      environment:
        SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/samurai
        SPRING_DATASOURCE_USERNAME: samurai
        SPRING_DATASOURCE_PASSWORD: password
        SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI: http://keycloak:8082/realms/hunters_league
        SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI: http://keycloak:8082/realms/hunters_league/protocol/openid-connect/certs
        SPRING_JPA_HIBERNATE_DDL_AUTO: none
        SPRING_JPA_SHOW_SQL: true
        SPRING_JPA_PROPERTIES_HIBERNATE_DEFAULT_SCHEMA: public
        SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL: true
        SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT: org.hibernate.dialect.PostgreSQLDialect
        SPRING_LIQUIBASE_ENABLED: false
        SPRING_LIQUIBASE_CHANGE_LOG: db/changelog/master.yaml
      networks:
        - app_network
      depends_on:
        - db
        - keycloak

    # Service pour la base de donn√©es PostgreSQL
    db:
      image: postgres:latest
      container_name: samurai_db
      environment:
        POSTGRES_PASSWORD: password
        POSTGRES_DB: samurai
        POSTGRES_USER: samurai
      volumes:
        - C:\Users\Youcode\Desktop\pgdata:/var/lib/postgresql/data
      ports:
        - '5433:5432'
      networks:
        - app_network

    # Service pour Keycloak
    keycloak:
      image: quay.io/keycloak/keycloak:latest
      container_name: hunters_league_keycloak
      environment:
        KEYCLOAK_ADMIN: admin
        KEYCLOAK_ADMIN_PASSWORD: admin
      command:
        - start-dev
      ports:
        - '8082:8080'
      networks:
        - app_network

  networks:
    app_network:
      driver: bridge

  volumes:
    postgres_data:
      driver: local
